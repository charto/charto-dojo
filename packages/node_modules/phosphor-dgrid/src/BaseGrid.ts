// This file is part of phosphor-dgrid, copyright (c) 2017-2018 BusFaster Ltd.
// Released under the MIT license, see LICENSE.

import 'dgrid/css/dgrid.css';
import 'dojo/resources/dnd.css';

import 'dojo';
import * as declare from 'dojo/_base/declare';
import * as aspect from 'dojo/aspect';
import * as OnDemandGrid from 'dgrid/OnDemandGrid';
import * as Keyboard from 'dgrid/Keyboard';
import * as Selection from 'dgrid/Selection';
import * as ColumnResizer from 'dgrid/extensions/ColumnResizer';

import { Widget } from '@phosphor/widgets';

export class BaseGrid<GridMixins> extends Widget {
	constructor(
		public dgrid: OnDemandGrid & Keyboard & Selection & ColumnResizer & GridMixins
	) {
		super({ node: BaseGrid.createNode() });

		this.addClass('phosphor-dgrid');
		this.addClass('charto-content');

		dgrid.domNode.classList.add('charto-content-inner');
		// Override height set by dgrid.
		dgrid.domNode.style.height = '100%';

		this.node.appendChild(dgrid.domNode);

		aspect.after(dgrid, 'renderRow', (row: HTMLElement, [item, options]: [any, Object]) => {
			row.classList.add(item.hasChildren ? 'dgrid-branch' : 'dgrid-leaf');
			return(row);
		});

		dgrid.startup();
	}

	static createNode(): HTMLElement {
		const node = document.createElement('div');
		return(node);
	}

	onResize(msg: Widget.ResizeMessage) {
		if(this.dgrid) this.dgrid.resize();
	}

	protected static DGrid = declare([ OnDemandGrid, Keyboard, Selection, ColumnResizer ]);
}
